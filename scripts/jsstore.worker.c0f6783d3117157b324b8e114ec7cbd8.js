var JsStoreWorker=function(se){var V={};function q(_){if(V[_])return V[_].exports;var d=V[_]={i:_,l:!1,exports:{}};return se[_].call(d.exports,d,d.exports,q),d.l=!0,d.exports}return q.m=se,q.c=V,q.d=function(_,d,h){q.o(_,d)||Object.defineProperty(_,d,{enumerable:!0,get:h})},q.r=function(_){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},q.t=function(_,d){if(1&d&&(_=q(_)),8&d||4&d&&"object"==typeof _&&_&&_.__esModule)return _;var h=Object.create(null);if(q.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:_}),2&d&&"string"!=typeof _)for(var K in _)q.d(h,K,function(x){return _[x]}.bind(null,K));return h},q.n=function(_){var d=_&&_.__esModule?function(){return _.default}:function(){return _};return q.d(d,"a",d),d},q.o=function(_,d){return Object.prototype.hasOwnProperty.call(_,d)},q.p="",q(q.s=2)}({2:function(se,V,q){"use strict";q.r(V),q.d(V,"QueryManager",function(){return De});var n,_=function(n){return Promise.resolve(n)},d=function(n){return new Promise(n)},h=(()=>{return(n=h||(h={})).InvalidUpdateColumn="invalid_update_column",n.UndefinedColumn="undefined_column",n.UndefinedValue="undefined_value",n.UndefinedColumnName="undefined_column_name",n.UndefinedDbName="undefined_database_name",n.UndefinedColumnValue="undefined_column_value",n.NotArray="not_array",n.NoValueSupplied="no_value_supplied",n.ColumnNotExist="column_not_exist",n.EnableSearchOff="enable_search_off",n.InvalidOp="invalid_operator",n.NullValue="null_value",n.WrongDataType="wrong_data_type",n.TableNotExist="table_not_exist",n.DbNotExist="db_not_exist",n.ConnectionAborted="connection_aborted",n.ConnectionClosed="connection_closed",n.NotObject="not_object",n.InvalidConfig="invalid_config",n.DbBlocked="Db_blocked",n.IndexedDbNotSupported="indexeddb_not_supported",n.NullValueInWhere="null_value_in_where",n.InvalidJoinQuery="invalid_join_query",n.InvalidOrderQuery="invalid_order_query",n.InvalidQuery="invalid_query",n.InvalidGroupQuery="invalid_group_query",n.ImportScriptsFailed="import_scripts_failed",n.MethodNotExist="method_not_exist",n.Unknown="unknown",n.InvalidMiddleware="invalid_middleware",h;var n})(),x=(()=>{return(n=x||(x={})).String="string",n.Object="object",n.Array="array",n.Number="number",n.Boolean="boolean",n.Null="null",n.DateTime="date_time",x;var n})(),m=(()=>{return(n=m||(m={})).InitDb="init_db",n.Get="get",n.Set="set",n.Select="select",n.Insert="insert",n.Update="update",n.Remove="remove",n.OpenDb="open_db",n.Clear="clear",n.DropDb="drop_db",n.Count="count",n.ChangeLogStatus="change_log_status",n.Terminate="terminate",n.Transaction="transaction",n.CloseDb="close_db",n.Union="union",n.Intersect="intersect",n.ImportScripts="import_scripts",n.Middleware="middleware",m;var n})(),f=(()=>{return(n=f||(f={})).Where="where",n.Like="like",n.Regex="regex",n.In="in",n.Equal="=",n.Between="-",n.GreaterThan=">",n.LessThan="<",n.GreaterThanEqualTo=">=",n.LessThanEqualTo="<=",n.NotEqualTo="!=",n.Aggregate="aggregate",n.Max="max",n.Min="min",n.Avg="avg",n.Count="count",n.Sum="sum",n.Or="or",n.Skip="skip",n.Limit="limit",n.And="and",n.IgnoreCase="ignoreCase",n.Then="then",f;var n})(),R=(()=>{return(n=R||(R={})).ReadOnly="readonly",n.ReadWrite="readwrite",R;var n})(),B=(()=>{return(n=B||(B={})).First="f",n.Last="l",n.Any="a",B;var n})(),Qe=function(){function n(t){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(t.columns),this.name=t.name,this.alter=t.alter||{}}return n.prototype.setColumn=function(t){var e=[],r=function(u){var s=t[u];s.name=u,s.autoIncrement&&(i.autoIncColumnValue[u]=0),s.primaryKey&&(i.primaryKey=u),s.enableSearch=s.enableSearch??!0;var a=i.columns.indexOf(function(l){return l.name===u});a<0?e.push(s):Object.assign(i.columns[a],s)},i=this;for(var o in t)r(o);return e},n}(),E=function(){function n(){}return n.autoIncrementKey=function(t,e){return"JsStore_"+t+"_"+e+"_Value"},n.set=function(t,e,r){r.tx||r.createTransaction([n.tableName]);var i=r.objectStore(n.tableName);return d(function(o,u){var s=i.put({key:t,value:e});s.onsuccess=function(){o()},s.onerror=u})},n.get=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return d(function(i,o){var u=r.get(e.keyRange(t));u.onsuccess=function(){var s=u.result;i(s&&s.value)},u.onerror=o})},n.remove=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return d(function(i,o){var u=r.delete(e.keyRange(t));u.onsuccess=i,u.onerror=o})},n.tableName="JsStore_Meta",n.dbSchema="JsStore_DbSchema",n}(),Oe=function(n){this.name=n.name,this.version=n.version||1,n.tables.push({name:E.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=n.tables.map(function(t){return new Qe(t)})},de=function(n,t){for(var e in n)t(e,n[e])},w=function(){function n(t,e){this.type=t,this.info_=e,this.message=this.getMsg_()}return n.prototype.log=function(t){this.status&&console.log(t)},n.prototype.throw=function(){throw this.get()},n.prototype.logError=function(){console.error(this.get())},n.prototype.get=function(){return{message:this.message,type:this.type}},n.prototype.getMsg_=function(){var t;switch(this.type){case h.NotArray:t="Supplied value is not an array";break;case h.UndefinedColumn:t="Column is undefined in Where";break;case h.UndefinedValue:t="Value is undefined in Where";break;case h.UndefinedColumnName:t="Column name is undefined '"+this.info_.TableName+"'";break;case h.UndefinedDbName:t="Database name is not supplied";break;case h.UndefinedColumnValue:t="Column value is undefined";break;case h.NoValueSupplied:t="No value is supplied";break;case h.InvalidOp:t="Invalid Op Value '"+this.info_.Op+"'";break;case h.ColumnNotExist:t=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case h.EnableSearchOff:t="Search is turned off for the Column '"+this.info_.column+"'";break;case h.NullValue:t="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case h.WrongDataType:t="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case h.TableNotExist:t="Table '"+this.info_.tableName+"' does not exist";break;case h.DbNotExist:t="Database with name "+this.info_.dbName+" does not exist";break;case h.NotObject:t="supplied value is not object";break;case h.InvalidOp:t="Invalid Config '"+this.info_.Config+" '";break;case h.DbBlocked:t="database is blocked, cant be deleted right now";break;case h.NullValueInWhere:t="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case h.MethodNotExist:t="method '"+this.info_+"' does not exist.";break;case h.IndexedDbNotSupported:t="Browser does not support indexeddb";break;case h.InvalidJoinQuery:case h.InvalidGroupQuery:case h.InvalidOrderQuery:case h.ImportScriptsFailed:t=this.info_;break;case h.InvalidMiddleware:t="No function "+this.info_+" is found.";break;default:this.type||(this.type=h.Unknown),t=this.message}return t},n}(),ye=function(){function n(){this.logger=new w(null)}return n.prototype.emptyTx=function(){!this.tx||(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},n.prototype.createTransactionIfNotExist=function(t,e){this.tx||this.createTransaction(t,e)},n.prototype.createTransaction=function(t,e){var r=this;return void 0===e&&(e=R.ReadWrite),this.tx=this.con.transaction(t,e),d(function(i,o){r.tx.oncomplete=i,r.tx.onabort=i,r.tx.onerror=o})},n.prototype.keyRange=function(t,e){var r;switch(e){case f.Between:r=IDBKeyRange.bound(t.low,t.high,!1,!1);break;case f.GreaterThan:r=IDBKeyRange.lowerBound(t,!0);break;case f.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(t);break;case f.LessThan:r=IDBKeyRange.upperBound(t,!0);break;case f.LessThanEqualTo:r=IDBKeyRange.upperBound(t);break;default:r=IDBKeyRange.only(t)}return r},n.prototype.objectStore=function(t){return this.tx.objectStore(t)},n.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},n.prototype.close=function(){var t=this;return this.con&&this.con.close(),d(function(e){t.con=null,setTimeout(e,100)})},n.prototype.initDb=function(t){var o,e=this,r=!1,i=t.version;return d(function(u,s){var a=indexedDB.open(t.name,i);a.onsuccess=function(){e.con=a.result,e.con.onversionchange=function(c){c.target.close()},u({isCreated:r,oldVersion:o,newVersion:i})},a.onerror=function(c){console.error("error",c),s(c)},a.onupgradeneeded=function(c){o=c.oldVersion;var l=c.target,v=l.result;r=!0;var p=l.transaction,b=v.objectStoreNames,y=function(k,S){var T=S.name;if(S.enableSearch&&!k.indexNames.contains(T)){var C=S.primaryKey?{unique:!0}:{unique:S.unique};C.multiEntry=S.multiEntry,k.createIndex(T,S.keyPath??T,C)}},A=function(k,S,T){var C=S.columns.findIndex(function(O){return O.name===T});C>=0&&(S.columns.splice(C,1),k.deleteIndex(T))};t.tables.forEach(function(k){if(!b.contains(k.name))return function(k){var T=v.createObjectStore(k.name,k.primaryKey?{keyPath:k.primaryKey}:{autoIncrement:!0});k.columns.forEach(function(C){y(T,C)})}(k);for(var S=p.objectStore(k.name),T=o+1;T<=i;T++){var C=k.alter[T];C&&(C.add&&k.setColumn(C.add).forEach(function(N){y(S,N),k.columns.push(N)}),de(C.drop||{},function(N){A(S,k,N)}),de(C.modify||{},function(N,D){var ve=D.multiEntry||D.keyPath||D.unique,ae=k.columns.find(function(Et){return Et.name===N}),pe=Object.assign(ae,D);pe.name=N,ve&&(A(S,k,N),y(S,pe),k.columns.push(pe))}))}});for(var Q=function(k){var S=b.item(k);t.tables.findIndex(function(C){return C.name===S})<0&&v.deleteObjectStore(S)},W=0,G=b.length;W<G;W++)Q(W)}})},n}(),X=function(n){return Promise.all(n)},L=function(n){return Promise.reject(n)},re=function(n){if(n instanceof w)return n.logError(),n.get();var t=void 0;return n.name?(t=new w(n.name)).message=n.message:(t=new w(n.target.error.name)).message=n.target.error.message,t.logError(),t.get()},J=function(){function n(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),n.prototype.table=function(t){var e=t||this.tableName;return this.db.tables.find(function(r){return r.name===e})},n.prototype.primaryKey=function(t){return this.table(t).primaryKey},n.prototype.getColumnInfo=function(t,e){return this.table(e).columns.find(function(r){return r.name===t})},n.prototype.onException=function(t,e){return console.error(t),this.util.abortTransaction(),L(function(n,t){return void 0===t&&(t=h.InvalidQuery),n.name=t,re(n)}(t,e))},n}(),j=function(n){if(null==n)return x.Null;var t=typeof n;if("object"===t){if(Array.isArray(n))return x.Array;if(n instanceof Date)return x.DateTime}return t},Z=function(n){return null==n||"number"==typeof n&&isNaN(n)},We=function(){function n(t,e){this.table=t,this.autoIncrementValue=e}return n.prototype.checkAndModifyValues=function(t){var r,e=this;this.query=t;var i=t.values,o=[];return i.every(function(u,s){return r=e.checkAndModifyValue(u),t.ignore&&r&&(o.push(s),r=null),!r}),o.forEach(function(u){i.splice(u,1)}),{err:r,values:i}},n.prototype.checkAndModifyValue=function(t){var r,e=this;return this.table.columns.every(function(i){return!(r=e.checkAndModifyColumnValue_(i,t))}),r},n.prototype.checkNotNullAndDataType_=function(t,e){return t.notNull&&Z(e[t.name])?this.getError(h.NullValue,{ColumnName:t.name}):t.dataType&&!Z(e[t.name])&&j(e[t.name])!==t.dataType?this.getError(h.WrongDataType,{column:t.name}):void 0},n.prototype.checkAndModifyColumnValue_=function(t,e){var r=e[t.name];if(t.autoIncrement?Z(r)?e[t.name]=++this.autoIncrementValue[t.name]:j(r)===x.Number&&r>this.autoIncrementValue[t.name]&&(this.autoIncrementValue[t.name]=r):void 0!==t.default&&Z(r)&&(e[t.name]=t.default),this.query.validation)return this.checkNotNullAndDataType_(t,e)},n.prototype.getError=function(t,e){return new w(t,e)},n}(),Be=function(){function n(t){this.table=t}return n.prototype.check=function(t,e){var i,r=this;return typeof t===x.Object?this.table?this.table.columns.every(function(o){return o.name in t&&(i=r.checkByColumn_(o,t[o.name])),!i}):i=new w(h.TableNotExist,{tableName:e}):i=new w(h.NotObject),i},n.prototype.checkByColumn_=function(t,e){if(!0===t.notNull&&Z(e))return new w(h.NullValue,{ColumnName:t.name});var r=j(e),i=null!=e;if(t.dataType&&i&&r!==t.dataType&&"object"!==r)return new w(h.WrongDataType,{column:t.name});if(i&&"object"===r){var o=["+","-","*","/","{push}"];for(var u in e)if(o.indexOf(u)<0&&t.dataType&&r!==t.dataType)return new w(h.WrongDataType,{column:t.name})}},n}(),P=function(){function n(t){this.db=t}return n.prototype.validate=function(t,e){switch(t){case m.Select:case m.Remove:case m.Count:return this.checkSelect(e);case m.Insert:return this.checkInsertQuery(e);case m.Update:return this.checkUpdate(e)}},n.prototype.getTable_=function(t){return this.db.tables.find(function(e){return e.name===t})},n.prototype.isInsertQryValid=function(t){var r,e=this.getTable_(t.into);if(e)switch(j(t.values)){case x.Array:break;case x.Null:r=new w(h.NoValueSupplied);break;default:r=new w(h.NotArray)}else r=new w(h.TableNotExist,{tableName:t.into});return{table:e,log:r}},n.prototype.checkUpdate=function(t){var e=new Be(this.getTable_(t.in)).check(t.set,t.in);if(e)return e;if(null!=t.where){if(e=this.checkForNullInWhere_(t))return e;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkSelect=function(t){if(!this.getTable_(t.from))return new w(h.TableNotExist,{tableName:t.from});if(t.where){var r=this.checkForNullInWhere_(t);if(r)return r;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkForNullInWhere_=function(t){for(var e in t.where)if(null==t.where[e])return new w(h.NullValueInWhere,{column:e})},n.prototype.addGreatAndLessToNotOp_=function(t){var e=t.where,r=function(a,c){return c.findIndex(function(l){return null!=a[l][f.NotEqualTo]})>=0},i=function(a,c){var l;return c.forEach(function(v){null!=(l=a[v])[f.NotEqualTo]&&(a[v][f.GreaterThan]=l[f.NotEqualTo],void 0===a[f.Or]?(a[f.Or]={},a[f.Or][v]={}):void 0===a[f.Or][v]&&(a[f.Or][v]={}),a[f.Or][v][f.LessThan]=l[f.NotEqualTo],delete a[v][f.NotEqualTo])}),a};if(j(e)===x.Object){var o=Object.keys(e);if(r(e,o))if(1===o.length)t.where=i(e,o);else{var u=[];o.forEach(function(a){var c;u.push(i(((c={})[a]=e[a],c),[a]))}),t.where=u}}else{var s=[];e.forEach(function(a){var c=Object.keys(a);r(a,c)&&(a=i(a,c)),s.push(a)}),t.where=s}},n.prototype.checkInsertQuery=function(t){var e=this.isInsertQryValid(t),r=e.table,i=e.log;if(i)return i;if(!t.skipDataCheck){var u=new We(r,r.autoIncColumnValue).checkAndModifyValues(t),a=u.err;return t.values=u.values,a}},n}(),Me=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),ge=function(n){function t(e,r){var i=n.call(this)||this;return i.valuesAffected_=[],null==e.validation&&(e.validation=!0),i.query=e,i.util=r,i.tableName=e.into,i}return Me(t,n),t.prototype.execute=function(e){var r=this,i=this.db,o=new P(i).validate(m.Insert,this.query);return o?L(o):e().then(function(){return r.insertData_(i).then(function(){return r.query.return?r.valuesAffected_:r.rowAffected})}).catch(function(u){return r.util.abortTransaction(),L(u)})},t.prototype.insertData_=function(e){var i,o,s,r=this,u=this.query;return i=u.return?function(s){r.valuesAffected_.push(s)}:function(){++r.rowAffected},s=u.upsert?"put":"add",o=u.ignore&&!r.isTxQuery?function(a){return r.util.con.transaction(u.into,R.ReadWrite).objectStore(u.into)[s](a)}:(r.isTxQuery||r.util.createTransaction([u.into,E.tableName]),r.objectStore=r.util.objectStore(r.tableName),function(a){return r.objectStore[s](a)}),X(u.values.map(function(s){return d(function(a,c){var l=o(s);l.onerror=function(v){u.ignore?a():c(v)},l.onsuccess=function(){i(s),a()}})})).then(function(){E.set(E.dbSchema,e,r.util)})},t}(J),me=typeof self.alert>"u"&&typeof ServiceWorkerGlobalScope>"u",Ve=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch{return!1}return!0}(),_e=function(n){return Object.keys(n)},F=function(n){return Array.isArray(n)},M=function(n){return _e(n).length},Y=function(n){for(var t in n)return t},Fe=function(){function n(){}return n.prototype.setCaseAndValue=function(t,e){this.caseQuery_=t,this.setValue(e)},n.prototype.setCaseAndColumn=function(t,e){return this.caseQuery_=t,this.setColumn(e),this},n.prototype.setColumn=function(t){return this.columnName_=t,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},n.prototype.setValue=function(t){return this.value=t,this},n.prototype.evaluate=function(){for(var t=0;t<this.length_;t++)if(!0===this.checkCase_(this.caseColumnQuery_[t]))return this.caseColumnQuery_[t].then;return this.caseColumnQuery_[this.length_-1].then??this.value[this.columnName_]},n.prototype.checkCase_=function(t){for(var e in t){switch(e){case f.GreaterThan:if(this.value[this.columnName_]>t[e])return!0;break;case f.Equal:if(this.value[this.columnName_]===t[e])return!0;break;case f.LessThan:if(this.value[this.columnName_]<t[e])return!0;break;case f.GreaterThanEqualTo:if(this.value[this.columnName_]>=t[e])return!0;break;case f.LessThanEqualTo:if(this.value[this.columnName_]<=t[e])return!0;break;case f.NotEqualTo:if(this.value[this.columnName_]!==t[e])return!0;break;case f.Between:if(this.value[this.columnName_]>t[e].low&&this.value[this.columnName_]<t[e].high)return!0}return!1}},n}(),Ke=function(n){var r,t=this,e=!1;return function(i){(r=i.target.result)?e&&t.results.length!==t.limitRecord?(t.pushResult(r.value),r.continue()):(e=!0,r.advance(t.skipRecord)):n()}},Je=function(n){var r,t=this,e=!1;return function(i){(r=i.target.result)?e?(t.pushResult(r.value),r.continue()):(e=!0,r.advance(t.skipRecord)):n()}},Ue=function(n){var e,t=this;return function(r){(e=r.target.result)?(t.pushResult(e.value),e.continue()):n()}},He=function(n){var e,t=this;return function(r){(e=r.target.result)&&t.results.length!==t.limitRecord?(t.pushResult(e.value),e.continue()):n()}},be=function(n){return n.replace(/\s/g,"")},xe=function(n){var t;if(null==this.query.join)t=this.getColumnInfo(n);else{var e=be(n).split(".");t=this.getColumnInfo(n=e[1],e[0])}if(null==t){var r=this.results[0][n];if(r)return{dataType:j(r),name:n};throw new w(h.ColumnNotExist,{column:n,isOrder:!0})}return t},we=function(n,t){return t.localeCompare(n)},ke=function(n,t){return n.localeCompare(t)},ze=function(n,t){return new String(t).localeCompare(n)},$e=function(n,t){return new String(n).localeCompare(t)},Se=function(n,t){return t-n},Ce=function(n,t){return n-t},Xe=function(n,t){return t.getTime()-n.getTime()},Ze=function(n,t){return n.getTime()-t.getTime()},Pe=function(n,t,e){for(var r in e){this.thenEvaluator.setCaseAndValue(e,n);var i=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(e,t);var o=this.thenEvaluator.setColumn(r).evaluate();return typeof n[i]===x.String?we(n[i],t[o]):Se(n[i],t[o])}},Ye=function(n,t,e){for(var r in e){this.thenEvaluator.setCaseAndValue(e,n);var i=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(e,t);var o=this.thenEvaluator.setColumn(r).evaluate();return typeof n[i]===x.String?ke(n[i],t[o]):Ce(n[i],t[o])}},je=function(n,t){switch(n.dataType){case x.String:return"asc"===t.type?ke:we;case x.Number:return"asc"===t.type?Ce:Se;case x.DateTime:return"asc"===t.type?Ze:Xe;default:return"asc"===t.type?$e:ze}},Ie=function(n){var t,e=this;n.type=qe(n.type);var r=n.by;if(null!=r&&typeof r===x.Object)this.results.sort("asc"===n.type?function(u,s){return Ye.call(e,u,s,r)}:function(u,s){return Pe.call(e,u,s,r)});else{var i=xe.call(this,r);if(null!=i){var o=je(i,n);r=i.name,null==n.case?this.results.sort(function(u,s){return o(u[r],s[r])}):(this.thenEvaluator.setCaseAndColumn(((t={})[r]=n.case,t),r),this.results.sort(function(u,s){return o(e.thenEvaluator.setValue(u).evaluate(),e.thenEvaluator.setValue(s).evaluate())}))}}},qe=function(n){return null==n?"asc":n.toLowerCase()},it=function(n){var t=this,e=!1;return function(r){var i=r.target.result;if(i)if(e&&t.results.length!==t.limitRecord){var o=i.value;t.shouldAddValue(o)&&t.pushResult(o),i.continue()}else e=!0,i.advance(t.skipRecord);else n()}},ot=function(n){var t=this,e=!1;return function(r){var i=r.target.result;if(i)if(e){var o=i.value;t.shouldAddValue(o)&&t.pushResult(o),i.continue()}else e=!0,i.advance(t.skipRecord);else n()}},ut=function(n){var t=this;return function(e){var r=e.target.result;if(r&&t.results.length!==t.limitRecord){var i=r.value;t.shouldAddValue(i)&&t.pushResult(i),r.continue()}else n()}},at=function(n){var t=this;return function(e){var r=e.target.result;if(r){var i=r.value;t.shouldAddValue(i)&&t.pushResult(i),r.continue()}else n()}},Te=function(n){var e,r,t=n.split("%");switch(t[1]?(e=t[1],r=t.length>2?B.Any:B.Last):(e=t[0],r=B.First),r){case B.First:return new RegExp("^"+e,"i");case B.Last:return new RegExp(e+"$","i");default:return new RegExp(""+e,"i")}},Ae=function(n){return"object"===j(n)&&!(n instanceof RegExp)},Le=function(n){if(Ae(n)){var t={};for(var e in n)t[e]=null!=n[e]&&Ae(n[e])?Le(n[e]):n[e];return t}return n},ee=function(n,t,e){var r=j(n);if(r!==j(t))return!1;switch(r===x.DateTime&&(n=n.getTime(),t=t.getTime()),e){case f.GreaterThan:return n>t;case f.LessThan:return n<t;case f.LessThanEqualTo:return n<=t;case f.GreaterThanEqualTo:return n>=t;case f.NotEqualTo:return n!==t;default:return n===t}},Ee=function(){function n(t,e){this.where=Le(t),this.checkFlag=e}return n.prototype.remove=function(t){var e=t.pop();delete t.reduce(function(i,o){return i&&i[o]},this.where)[e]},n.prototype.check=function(t){var e=!0;if(!this.checkFlag)return e;for(var r in this.where){if(!e)return e;var i=this.where[r],o=t[r];if("object"===j(i))for(var u in i){if(!e)return e;switch(u){case f.In:e=this.checkIn(r,o);break;case f.Like:e=this.checkLike_(r,o);break;case f.Regex:e=this.checkRegex(r,o);break;case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:case f.NotEqualTo:e=this.checkComparisionOp_(r,o,u);break;default:e=!1}}else e=ee(i,o)}return e},n.prototype.checkIn=function(t,e){return null!=this.where[t][f.In].find(function(r){return ee(r,e)})},n.prototype.checkLike_=function(t,e){return Te(this.where[t][f.Like]).test(e)},n.prototype.checkRegex=function(t,e){return this.where[t][f.Regex].test(e)},n.prototype.checkComparisionOp_=function(t,e,r){var i=this.where[t][r];return r!=f.Between?ee(e,i,r):ee(e,i.low,">=")&&ee(e,i.high,"<=")},n}(),st=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ne=function(n){function t(){var e=null!==n&&n.apply(this,arguments)||this;return e.shouldEvaluateLimitAtEnd=!1,e.shouldEvaluateSkipAtEnd=!1,e}return st(t,n),t.prototype.goToWhereLogic=function(){var e=this.query,r=Y(e.where);if(!this.objectStore.indexNames.contains(r)){var a=this.getColumnInfo(r),c=new w(null==a?h.ColumnNotExist:h.EnableSearchOff,{column:r});return L(c)}var i=e.where[r];if("object"!==j(i))return o=M(e.where)>1,this.whereCheckerInstance=new Ee(e.where,o),this.whereCheckerInstance.remove([r]),this.executeWhereLogic(r,i,null,"next");var o=M(i)>1||M(e.where)>1;this.whereCheckerInstance=new Ee(e.where,o);var u=Y(i);switch(this.whereCheckerInstance.remove([r,u]),u){case f.Like:var s=Te(i[f.Like]);return this.executeRegexLogic(r,s);case f.Regex:return this.executeRegexLogic(r,i[f.Regex]);case f.In:return this.executeInLogic(r,i[f.In]);case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:return this.executeWhereLogic(r,i,u,"next");case f.Aggregate:break;default:return this.executeWhereLogic(r,i,null,"next")}},t}(J),ct=function(n,t){var e=this;return function(r){var i=r.target.result;if(e.results.length!==e.limitRecord&&i){var o=i.value;e.shouldAddValue(o)&&t(o),i.continue()}else n()}},lt=function(n,t){var e=this;return function(r){var i=r.target.result;if(i){var o=i.value;e.shouldAddValue(o)&&t(o),i.continue()}else n()}},ft=function(n){var t=this;return function(e){var r=e.target.result;r&&t.results.length!==t.limitRecord?(t.shouldAddValue(r.value)&&t.pushResult(r.value),r.continue()):n()}},ht=function(n){var t=this;return function(e){var r=e.target.result;if(r){var i=r.value;t.shouldAddValue(i)&&t.pushResult(i),r.continue()}else n()}},vt=function(n,t){var e=this;return function(r){var i=r.target.result;e.results.length!==e.limitRecord&&i?(e.shouldAddValue(i)&&t(i.value),i.continue()):n()}},pt=function(n,t){var e=this;return function(r){var i=r.target.result;i?(e.shouldAddValue(i)&&t(i.value),i.continue()):n()}},dt=function(n){var t=this;return function(e){var r=e.target.result;t.results.length!==t.limitRecord&&r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},yt=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},U=function(){return U=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},U.apply(this,arguments)},gt=function(){function n(t){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=t}return Object.defineProperty(n.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),n.prototype.getTable=function(t){return this.select.table(t)},n.prototype.executeSelect=function(t){return new I(t,this.select.util).execute()},n.prototype.execute=function(){var t=this,e=this.query;this.joinQueryStack_=j(e.join)===x.Object?[e.join]:e.join;for(var r=e.from,i=[r],o=0,u=this.joinQueryStack_.length;o<u;o++){var s=this.joinQueryStack_[o],a=this.getJoinTableInfo_(s.on);s.with===a.table1.table&&(a={table1:a.table2,table2:a.table1});var c=this.checkJoinQuery_(a,s);if(c)return L(c);this.joinQueryStack_[o].joinTableInfo=a,i.push(s.with)}return this.select.isTxQuery||this.select.util.createTransaction(i),this.executeSelect({from:r,where:e.where,case:e.case,flatten:e.flatten}).then(function(l){return t.results=l.map(function(v){var p;return(p={})[t.currentQueryStackIndex_]=v,p}),t.tablesFetched.push(r),t.startExecutingJoinLogic_()})},n.prototype.onJoinQueryFinished_=function(){var t=this;if(this.results.length>0)try{var e=[],i=Object.keys(this.results[0]).length,o=function(u,s){if(null!=u.as)for(var a in u.as)void 0===s[u.as[a]]&&(s[u.as[a]]=s[a],delete s[a]);return s};this.results.forEach(function(u){for(var s=u[0],a=1;a<i;a++){var c=t.joinQueryStack_[a-1];s=U(U({},s),o(c,u[a]))}e.push(s)}),this.select.results=e,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null;try{this.select.processOrderBy()}catch(u){return L(new w(h.InvalidOrderQuery,u.message))}try{this.select.processGroupDistinctAggr()}catch(u){return L(new w(h.InvalidGroupQuery,u.message))}}catch(u){return L(new w(h.InvalidJoinQuery,u.message))}},n.prototype.startExecutingJoinLogic_=function(){var t=this,e=this.joinQueryStack_[this.currentQueryStackIndex_];if(!e)return this.onJoinQueryFinished_();try{var r=e.joinTableInfo;return this.executeSelect({from:e.with,where:e.where,case:e.case,flatten:e.flatten}).then(function(i){return t.jointables(e.type,r,i),t.tablesFetched.push(r.table2.table),++t.currentQueryStackIndex_,t.startExecutingJoinLogic_()})}catch(i){return L(new w(h.InvalidJoinQuery,i.message))}},n.prototype.jointables=function(t,e,r){var b,p,y,i=this,o=[],u=e.table1.column,s=e.table2.column,a=this.tablesFetched.indexOf(e.table1.table),c=this.currentQueryStackIndex_+1;"left"===t?(p=0,y={},i.getTable(e.table2.table).columns.forEach(function(A){y[A.name]=null}),i.results.forEach(function(A){b=[],r.forEach(1===c?function(Q){A[a][u]===Q[s]&&b.push(Q)}:function(Q){var W=A[a];null!=W&&W[u]===Q[s]&&b.push(Q)}),0===b.length&&(b=[y]),b.forEach(function(Q){o[p]=U({},A),o[p++][c]=Q})})):function(){var p=0;i.results.forEach(function(b){r.forEach(function(g){b[a][u]===g[s]&&(o[p]=U({},b),o[p++][c]=g)})})}(),this.results=o},n.prototype.getJoinTableInfo_=function(t){var e=(t=be(t)).split("="),r=e[0].split("."),i=e[1].split(".");return{table1:{table:r[0],column:r[1]},table2:{table:i[0],column:i[1]}}},n.prototype.checkJoinQuery_=function(t,e){var s,r=t.table1,i=t.table2,o=this.getTable(r.table),u=this.getTable(i.table);return e.with!==i.table&&(s=new w(h.InvalidJoinQuery,"on value should contains value of with")),null==o.columns.find(function(a){return a.name===r.column})?s=new w(h.InvalidJoinQuery,"column "+r.column+" does not exist in table "+r.table):null==u.columns.find(function(a){return a.name===i.column})&&(s=new w(h.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==e.as&&(e.as={}),o.columns.every(function(a){var c=u.columns.find(function(l){return l.name===a.name&&l.name!==r.column});return null==c||null!=e.as[c.name]||(s=new w(h.InvalidJoinQuery,"column "+a.name+" exist in both table "+r.table+" & "+i.table),!1)}),s},n}(),mt=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ie=function(){return ie=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},ie.apply(this,arguments)},oe=function(n,t){for(var e=0,r=t.length,i=n.length;e<r;e++,i++)n[i]=t[e];return n},I=function(n){function t(e,r){var i=n.call(this)||this;return i.sorted=!1,i.isSubQuery=!1,i.thenEvaluator=new Fe,i.returnResult_=function(){if(i.results.length>0){if(i.query.flatten){var o=[],u={};i.query.flatten.forEach(function(a){i.results.forEach(function(c,l){c[a].forEach(function(v){var p;o.push(ie(ie({},c),((p={})[a]=v,p)))}),u[l]=!0})});var s=0;_e(u).forEach(function(a){i.results.splice(Number(a)-s,1),++s}),i.results=i.results.concat(o)}i.processGroupDistinctAggr(),i.processOrderBy(),i.shouldEvaluateSkipAtEnd&&i.results.splice(0,i.query.skip),i.shouldEvaluateLimitAtEnd&&(i.results=i.results.slice(0,i.query.limit))}return i.results},i.query=e,i.util=r,i.tableName=e.from,i.setPushResult(),F(i.query.where)?(i.isArrayQry=!0,i.setLimitAndSkipEvaluationAtEnd_()):(i.skipRecord=e.skip,i.limitRecord=e.limit),e.order?((F(e.order)||e.order.case||function(n){return"object"==typeof n}(e.order.by))&&(i.query.order.idbSorting=!1),i.setLimitAndSkipEvaluationAtEnd_()):e.groupBy&&i.setLimitAndSkipEvaluationAtEnd_(),i}return mt(t,n),t.prototype.execute=function(e){var r=this;e||(e=function(){return _(null)});try{var o=new P(this.db).validate(m.Select,this.query);return o?L(o):e().then(function(){return r.initTransaction_(),(null==r.query.join?null!=r.query.where?F(r.query.where)?r.processWhereArrayQry():r.processWhere_():r.executeWhereUndefinedLogic():r.executeJoinQuery()).then(r.returnResult_.bind(r))})}catch(u){return this.onException(u)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var s,r=this.query.where,i=this.primaryKey(),o=!0,u=[],c=function(){var p;if(s===f.And?!0===o?u=e.results:u.length>0&&(p=[],e.results.forEach(function(b){var v;v=b[i],u.findIndex(function(p){return p[i]===v})>=0&&p.push(b)}),u=p,p=null):(u.length>0&&(e.results=oe(oe([],u),e.results),e.removeDuplicates()),u=e.results),o=!1,r.length>0)return e.results=[],l();e.results=u},l=function(){return e.query.where=r.shift(),e.query.where[f.Or]&&1===M(e.query.where)?(s=f.Or,e.query.where=e.query.where[f.Or]):s=f.And,e.processWhere_().then(c)};return l()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],R.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereCheckerInstance.check(r)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=oe(oe([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=Y(this.orInfo.orQuery);if(null!=e){var r={};return r[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=r,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(ne);I.prototype.executeInLogic=function(n,t){var e=this,r=this.skipRecord,i=function(a){0===r?e.pushResult(a):--r},o=function(){if(!1===e.shouldEvaluateLimitAtEnd&&!1===e.shouldEvaluateSkipAtEnd){if(e.skipRecord&&e.limitRecord)return ct;if(e.skipRecord)return lt;if(e.limitRecord)return ft}return ht}(),u=this.objectStore.index(n);return X(t.map(function(a){return function(a){return d(function(c,l){var v=u.openCursor(e.util.keyRange(a));v.onsuccess=o.call(e,c,i),v.onerror=l})}(a)}))},I.prototype.executeWhereUndefinedLogic=function(){var t,n=this;if(this.query.order&&!1!==this.query.order.idbSorting&&this.query.order.by){if(!this.objectStore.indexNames.contains(this.query.order.by))return L(new w(h.ColumnNotExist,{column:this.query.order.by,isOrder:!0}));var e=this.query.order.type&&"desc"===this.query.order.type.toLowerCase()?"prev":"next";this.sorted=!0,t=this.objectStore.index(this.query.order.by).openCursor(null,e)}else t=this.objectStore.openCursor();var r=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return Ke;if(n.skipRecord)return Je;if(n.limitRecord)return He}return Ue}();return d(function(i,o){t.onerror=o,t.onsuccess=r.call(n,i)})},I.prototype.executeWhereLogic=function(n,t,e,r){var i=this;t=e?t[e]:t;var o=this.objectStore.index(n).openCursor(this.util.keyRange(t,e),r),u=function(){if(!1===i.shouldEvaluateLimitAtEnd&&!1===i.shouldEvaluateSkipAtEnd){if(i.skipRecord&&i.limitRecord)return it;if(i.skipRecord)return ot;if(i.limitRecord)return ut}return at}();return d(function(s,a){o.onerror=a,o.onsuccess=u.call(i,s)})},I.prototype.executeRegexLogic=function(n,t){var e=this,r=this.skipRecord,i=function(s){0===r?e.pushResult(s):--r};this.shouldAddValue=function(s){return t.test(s.key)&&e.whereCheckerInstance.check(s.value)};var o=this.objectStore.index(n).openCursor(),u=function(){if(!1===e.shouldEvaluateLimitAtEnd&&!1===e.shouldEvaluateSkipAtEnd){if(e.skipRecord&&e.limitRecord)return vt;if(e.skipRecord)return pt;if(e.limitRecord)return dt}return yt}();return d(function(s,a){o.onerror=a,o.onsuccess=u.call(e,s,i)})},I.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},I.prototype.setPushResult=function(){var n=this;this.pushResult=this.query.case?function(t){for(var e in n.thenEvaluator.setCaseAndValue(n.query.case,t),n.query.case)t[e]=n.thenEvaluator.setColumn(e).evaluate();n.results.push(t)}:function(t){n.results.push(t)}},I.prototype.removeDuplicates=function(){var n=this.results;this.results=null;for(var t=this.primaryKey(),e={},r=0,i=n.length;r<i;r++)e[n[r][t]]=n[r];for(var r in n=[],e)n.push(e[r]);this.results=n},I.prototype.executeJoinQuery=function(){return new gt(this).execute()},I.prototype.processGroupDistinctAggr=function(){if(this.query.distinct){var n=[],t=this.results[0];for(var e in t)n.push(e);var r=this.primaryKey(),i=n.indexOf(r);n.splice(i,1),this.query.groupBy=n.length>0?n:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},I.prototype.processOrderBy=function(){var n=this.query.order;if(n&&this.results.length>0&&!this.sorted){var t=j(n);if(t===x.Object)Ie.call(this,n);else if(t===x.Array){Ie.call(this,n[0]);for(var e=function(u){var s=n[u-1].by,a=n[u],c=a.by,l=xe.call(r,c);if(null!=l){c=l.name,a.type=qe(a.type);var v=je(l,a);r.results.sort(function(p,b){return p[s]===b[s]?v(p[c],b[c]):0})}},r=this,i=1,o=n.length;i<o;i++)e(i)}}},I.prototype.processAggregateQry=function(){var r,n=this.results,t=n.length,e={};this.results=void 0;var i=function(){var g=0;for(var y in n)g+=n[y][r]?1:0;return g},o=function(){var g=0;for(var y in n)g=g>n[y][r]?g:n[y][r];return g},u=function(){var g=1/0,y=1/0;for(var A in n)g=g<(y=n[A][r]?n[A][r]:1/0)?g:y;return g},s=function(){var g=0;for(var y in n)g+=n[y][r];return g},a=function(){var g=0;for(var y in n)g+=n[y][r];return g/t};for(var c in this.query.aggregate){var l=this.query.aggregate[c],v=j(l),p=void 0;switch(c){case"count":p=i;break;case"max":p=o;break;case"min":p=u;break;case"sum":p=s;break;case"avg":p=a}switch(v){case x.String:e[c+"("+(r=l)+")"]=p();break;case x.Array:for(var b in l)e[c+"("+(r=l[b])+")"]=p()}}for(var c in e)n[0][c]=e[c];this.results=[n[0]]},I.prototype.executeAggregateGroupBy=function(){var n=this.query.groupBy,t=this.results;this.results=void 0;var i,o,u,e={},r=this.query.aggregate,s=function(){var W=function(){return o=(o=e[i])?o["count("+u+")"]:0,o+=t[a][u]?1:0},G=function(){return o=(o=e[i])?o["max("+u+")"]:0,t[a][u]=t[a][u]?t[a][u]:0,o>t[a][u]?o:t[a][u]},k=function(){return o=(o=e[i])?o["min("+u+")"]:1/0,t[a][u]=t[a][u]?t[a][u]:1/0,o<t[a][u]?o:t[a][u]},S=function(){return o=(o=e[i])?o["sum("+u+")"]:0,o+=t[a][u]?t[a][u]:0},T=function(){var ae=(o=e[i])?o["sum("+u+")"]:0;t[a]["sum("+u+")"]=ae+=t[a][u]?t[a][u]:0,o=o?o["count("+u+")"]:0,t[a]["count("+u+")"]=o+=t[a][u]?1:0};for(var C in r){var O=r[C],N=j(O),D=void 0;switch(C){case f.Count:D=W;break;case f.Max:D=G;break;case f.Min:D=k;break;case f.Sum:D=S;break;case f.Avg:D=T}switch(N){case x.String:t[a][C+"("+(u=O)+")"]=D();break;case x.Array:for(var ve in O)t[a][C+"("+(u=O[ve])+")"]=D()}}};if(j(n)===x.String)for(var a in t)i=t[a][n],s(),e[i]=t[a];else for(a in t){for(var c in i="",n)i+=t[a][n[c]];s(),e[i]=t[a]}for(var l in t=[],e)t.push(e[l]);if(r.avg)if(j(r.avg)===x.String)for(a in t)t[a]["avg("+r.avg+")"]=t[a]["sum("+r.avg+")"]/t[a]["count("+r.avg+")"],r.count!==r.avg&&delete t[a]["count("+r.avg+")"],r.sum!==r.avg&&delete t[a]["sum("+r.avg+")"];else{var b=j(r.count)===x.String,g=j(r.sum)===x.String;for(a in t)for(var c in r.avg){var y=r.avg[c];t[a]["avg("+y+")"]=t[a]["sum("+y+")"]/t[a]["count("+y+")"],b&&(r.count!==y||-1===r.count.indexOf(y))&&delete t[a]["count("+y+")"],g&&(r.sum!==y||-1===r.sum.indexOf(y))&&delete t[a]["sum("+y+")"]}}this.results=t},I.prototype.processGroupBy=function(){var n=this.query.groupBy,t=this.results,e={};if(this.results=this.query.groupBy=null,j(n)!==x.Object)if(j(n)===x.String)for(var r in t)e[t[r][n]]=t[r];else{var i=void 0;for(var r in t){for(var o in i="",n)i+=t[r][n[o]];e[i]=t[r]}}else if(1===Object.keys(n).length){var s=Y(n);for(var r in this.thenEvaluator.setCaseAndColumn(n,s),t)e[this.thenEvaluator.setValue(t[r]).evaluate()]=t[r]}else for(var r in i=void 0,t){for(var o in i="",this.thenEvaluator.setCaseAndValue(n,t[r]),n)i+=this.thenEvaluator.setColumn(o).evaluate();e[i]=t[r]}for(var r in t=[],e)t.push(e[r]);this.results=t};var _t=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),H=function(n){function t(e,r){var i=n.call(this)||this;return i.resultCount=0,i.query=e,i.util=r,i.tableName=e.from,i}return _t(t,n),t.prototype.execute=function(e){var r=this,i=new P(this.db),o=this.query,u=i.validate(m.Count,o);return u?L(u):e().then(function(){var s;try{var a=function(){var c=new I(r.query,r.util);return c.isTxQuery=r.isTxQuery,c.execute().then(function(l){r.resultCount=l.length})};r.initTransaction_(),s=null==o.join?null!=o.where?o.where.or||F(r.query.where)?a():r.goToWhereLogic():r.executeWhereUndefinedLogic():a()}catch(c){r.onException(c)}return s.then(function(){return r.resultCount})})},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],R.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(ne);H.prototype.executeWhereUndefinedLogic=function(){var t,r,n=this,e=n.objectStore.count?(t=n.objectStore.count(),function(i){return function(){n.resultCount=t.result,i()}}):(t=n.objectStore.openCursor(),function(i){return function(o){(r=o.target.result)?(++n.resultCount,r.continue()):i()}});return d(function(r,i){t.onerror=i,t.onsuccess=e(r)})},H.prototype.executeWhereLogic=function(n,t,e){var i,o,r=this;return t=e?t[e]:t,d(function(u,s){1===M(r.query.where)&&r.objectStore.count?(i=r.objectStore.index(n).count(r.util.keyRange(t,e))).onsuccess=function(){r.resultCount=i.result,u()}:(i=r.objectStore.index(n).openCursor(r.util.keyRange(t,e))).onsuccess=function(a){(o=a.target.result)?(r.whereCheckerInstance.check(o.value)&&++r.resultCount,o.continue()):u()},i.onerror=s})},H.prototype.executeRegexLogic=function(n,t){var r,e=this,i=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereCheckerInstance.check(o.value)},d(function(o,u){i.onerror=u,i.onsuccess=function(s){(r=s.target.result)?(e.shouldAddValue(r)&&++e.resultCount,r.continue()):o()}})},H.prototype.executeInLogic=function(n,t){var r,e=this,i=this.objectStore.index(n);return X(t.map(function(u){return function(u){var s=e.util.keyRange(u);return d(e.objectStore.count?function(a,c){var l=i.count(s);l.onsuccess=function(v){e.resultCount+=v.target.result,a()},l.onerror=c}:function(a,c){var l=i.openCursor(s);l.onsuccess=function(v){(r=v.target.result)?(e.whereCheckerInstance.check(r.value)&&++e.resultCount,r.continue()):a()},l.onerror=c})}(u)}))};var te=function(n){return(F(n)?n:n.split(".")).reduce(function(e,r){return e&&e[r]},self)},ue=function(n,t){var e=n.set,r=n.mapSet;if(r){var i=r(e,t);null!=i&&(e=i)}for(var o in e){var u=e[o];if(j(u)!==x.Object)t[o]=u;else for(var s in u){var a=u[s];switch(s){case"+":t[o]+=a;break;case"-":t[o]-=a;break;case"*":t[o]*=a;break;case"/":t[o]/=a;break;case"{push}":t[o].push(a);break;default:t[o]=u}break}}return t},bt=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),z=function(n){function t(e,r){var i=n.call(this)||this;i.query=e,i.util=r,i.tableName=e.in;var o=e.mapSet;if(o){var u=j(o)===x.String?te(o):o;if(!u)throw new w(h.MethodNotExist,o);e.mapSet=u}return i}return bt(t,n),t.prototype.execute=function(e){var r=this,i=this.query;try{var u=new P(this.db).validate(m.Update,i);return u?L(u):e().then(function(){return r.initTransaction(),(null!=i.where?i.where.or||F(i.where)?r.executeComplexLogic_():r.goToWhereLogic():r.executeWhereUndefinedLogic()).then(function(){return r.rowAffected})})}catch(s){return this.onException(s)}},t.prototype.executeComplexLogic_=function(){var e=this,r=this.query,i=new I({from:r.in,where:r.where,ignoreCase:r.ignoreCase},this.util);return i.isTxQuery=this.isTxQuery,i.execute().then(function(o){var u,s,a=e.primaryKey(r.in),c=[];o.forEach(function(v){c.push(v[a])}),o=null;var l=((u={})[a]=((s={})[f.In]=c,s),u);return e.query.where=l,e.initTransaction(),e.goToWhereLogic()})},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(ne);z.prototype.executeWhereUndefinedLogic=function(){var n=this,t=this.objectStore.openCursor();return d(function(e,r){t.onsuccess=function(i){var o=i.target.result;if(o)try{var u=o.update(ue(n.query,o.value));u.onsuccess=function(){++n.rowAffected,o.continue()},u.onerror=r}catch(s){r(s)}else e()},t.onerror=r})},z.prototype.executeWhereLogic=function(n,t,e){var r=this,i=this.query;t=e?t[e]:t;var o=this.objectStore.index(n).openCursor(this.util.keyRange(t,e));return d(function(u,s){o.onsuccess=function(a){var c=a.target.result;if(c)if(r.whereCheckerInstance.check(c.value))try{var l=c.update(ue(i,c.value));l.onsuccess=function(){++r.rowAffected,c.continue()},l.onerror=s}catch(v){s(v)}else c.continue();else u()},o.onerror=s})},z.prototype.executeRegexLogic=function(n,t){var r,e=this,i=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereCheckerInstance.check(o.value)},d(function(o,u){i.onsuccess=function(s){if(r=s.target.result)if(e.shouldAddValue(r))try{var a=r.update(ue(e.query,r.value));a.onsuccess=function(){++e.rowAffected,r.continue()},a.onerror=u}catch(c){u(c)}else r.continue();else o()},i.onerror=u})},z.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n),i=this.query;return X(t.map(function(u){return function(u){return d(function(s,a){var c=r.openCursor(e.util.keyRange(u));c.onsuccess=function(l){var v=l.target.result;if(v){var p=v.value;if(e.whereCheckerInstance.check(p))try{var b=v.update(ue(i,p));b.onsuccess=function(){++e.rowAffected,v.continue()},b.onerror=a}catch(g){a(g)}else v.continue()}else s()},c.onerror=a})}(u)}))};var xt=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fe=function(){return fe=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},fe.apply(this,arguments)},wt=function(n){function t(e,r){var i=n.call(this)||this;return i.query=e,i.util=r,i}return xt(t,n),t.prototype.execute=function(){var l,e=this,r=this.query,i=0,o={},u={},s=!0,a=r.queries,c=a.length;if(a.every(function(g,y){return!(y+1<c&&g.from!==a[y+1].from&&(s=!1,1))}),s){var v=this.primaryKey(a[0].from);l=function(g){return g[v]}}else l=function(g){var y="";for(var A in g)y+=g[A];return y};var p,b=function(){if(i<c)return(p=new I(a[i],e.util)).execute().then(function(O){return o={},O.forEach(function(N){var D=l(N);0===i?u[D]=N:null!=u[D]&&(o[D]=N)}),i>0&&(u=fe({},o)),++i,b()});var g=[],y=void 0,A=r.skip,Q=r.limit,G=!1,k=function(){g.push(o[C])},S=function(){g.length<Q?k():G=!0},T=function(O){0===A?O():--A};if(y=r.skip&&r.limit?function(){T(function(){S()})}:r.limit?S:r.skip?function(){T(function(){k()})}:function(){k()},Q){for(var C in o)if(y(C),G)break}else for(C in o)y(C);return p.results=g,Object.assign(p.query,{order:r.order,join:{}}),p.processOrderBy(),p.processGroupDistinctAggr(),p.results};return b()},t}(J),kt=function(){function n(){}return n.prototype.execute=function(t){return d(function(e,r){var i=indexedDB.deleteDatabase(t);i.onblocked=function(){var o=new w(h.DbBlocked);return r(re(o))},i.onerror=function(o){return r(re(o))},i.onsuccess=function(){e()}})},n}(),St=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ct=function(n){function t(e,r){var i=n.call(this)||this;return i.query=e,i.util=r,i}return St(t,n),t.prototype.execute=function(){var a,e=this,r=this.query,i=0,o={},u=!0,s=r.length;if(r.every(function(p,b){return!(b+1<s&&p.from!==r[b+1].from&&(u=!1,1))}),u){var c=this.primaryKey(r[0].from);a=function(p){return p[c]}}else a=function(p){var b="";for(var g in p)b+=p[g];return b};var v=function(){if(i<r.length)return new I(r[i++],e.util).execute().then(function(g){return g.forEach(function(y){o[a(y)]=y}),v()});var p=[];for(var b in o)p.push(o[b]);return p};return v()},t}(J),jt=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),$=function(n){function t(e,r){var i=n.call(this)||this;return i.query=e,i.util=r,i.tableName=e.from,i}return jt(t,n),t.prototype.execute=function(e){var s,r=this,i=new P(this.db),o=this.query,u=i.validate(m.Remove,o);return u?L(u):e().then(function(){try{r.initTransaction_(),s=null!=o.where?F(o.where)?r.processWhereArrayQry():r.processWhere_():r.executeWhereUndefinedLogic()}catch(a){return r.onException(a)}return s.then(function(){return r.rowAffected})})},t.prototype.processWhereArrayQry=function(){var e=this,r=new I(this.query,this.util);return r.isTxQuery=this.isTxQuery,r.execute().then(function(i){var o,u,s=[],a=e.primaryKey(e.query.from);i.forEach(function(l){s.push(l[a])}),i=null;var c=((o={})[a]=((u={})[f.In]=s,u),o);return e.query[f.Where]=c,e.processWhere_()})},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,r=Y(this._orInfo.OrQuery);if(null!=r){var i={};return i[r]=this._orInfo.OrQuery[r],delete this._orInfo.OrQuery[r],this.query.where=i,this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(ne);$.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n);return X(t.map(function(o){return function(o){return d(function(u,s){var a=r.openCursor(e.util.keyRange(o));a.onsuccess=function(c){var l=c.target.result;l?(e.whereCheckerInstance.check(l.value)&&(l.delete(),++e.rowAffected),l.continue()):u()},a.onerror=s})}(o)}))},$.prototype.executeWhereUndefinedLogic=function(){var t,n=this,e=this.objectStore.openCursor();return d(function(r,i){e.onsuccess=function(o){(t=o.target.result)?(t.delete(),++n.rowAffected,t.continue()):r()},e.onerror=i})},$.prototype.executeWhereLogic=function(n,t,e){var i,o,r=this;return t=e?t[e]:t,o=this.objectStore.index(n).openCursor(this.util.keyRange(t,e)),d(function(u,s){o.onsuccess=function(a){(i=a.target.result)?(r.whereCheckerInstance.check(i.value)&&(i.delete(),++r.rowAffected),i.continue()):u()},o.onerror=s})},$.prototype.executeRegexLogic=function(n,t){var r,e=this,i=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereCheckerInstance.check(o.value)},d(function(o,u){i.onsuccess=function(s){(r=s.target.result)?(e.shouldAddValue(r)&&(r.delete(),++e.rowAffected),r.continue()):o()},i.onerror=u})};var It=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qt=function(n){function t(e,r){var i=n.call(this)||this;return i.query=e,i.util=r,i.tableName=e,i}return It(t,n),t.prototype.execute=function(e){var r=this,i=this.query;return this.isTxQuery||this.util.createTransaction([i,E.tableName]),e().then(function(){var o=r.util.objectStore(i).clear();try{return d(function(u,s){o.onsuccess=function(){var a=r.table(i);for(var c in a.autoIncColumnValue)a.autoIncColumnValue[c]=0;E.set(E.dbSchema,r.util.db,r.util).then(function(){u()}).catch(s)},o.onerror=s})}catch(u){return r.onException(u)}})},t}(J),Tt=function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),At=function(n){function t(e,r){var i=n.call(this)||this;return i.results={},i.reqQueue=[],i.isQueryExecuting=!1,i.isTxStarted_=!1,i.query=e,i.util=r,i}return Tt(t,n),t.prototype.execute=function(e){var r=this;this.beforeExecute=e;var i=this.validate();return i?L(i):(this.startExecution_(),d(function(o,u){r.onSuccess=o,r.onError=u}).then(function(o){return r.beforeExecute=null,r.log("transaction finished"),o}))},t.prototype.validate=function(){var e=this.query,r=this.notExistingTable_(e.tables);if(r)return new w(h.TableNotExist,{tableName:r});var i=e.method;return te(i)?void 0:new w(h.MethodNotExist,i)},t.prototype.startExecution_=function(){var e=this,r=this.query,l=te(r.method);return this.log("transaction query started"),l.call(this,{data:r.data,insert:function(v){return e.pushReq_({name:m.Insert,query:v})},select:function(v){return e.pushReq_({name:m.Select,query:v})},update:function(v){return e.pushReq_({name:m.Update,query:v})},remove:function(v){return e.pushReq_({name:m.Remove,query:v})},count:function(v){return e.pushReq_({name:m.Count,query:v})},setResult:function(v,p){e.results[v]=p},getResult:function(v){return e.results[v]},abort:function(v){e.abortTx_(v)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var r=this.query.tables;return r=r.concat(E.tableName),this.util.createTransaction(r).then(function(){e.onSuccess(e.results)}).catch(function(i){e.onError(i)}),this.processExecutionOfQry_()}catch(i){this.onError(this.onException(i))}},t.prototype.onReqFinished_=function(e){var r=this.reqQueue.shift();this.log("finished request : "+r.name+" "),r&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,r.onSuccess&&r.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : "+e)},t.prototype.executeRequest_=function(e){var r;this.isQueryExecuting=!0,this.log("executing request : "+e.name+" ");var i=this.onReqFinished_.bind(this),o=e.query;switch(e.name){case m.Select:r=new I(o,this.util);break;case m.Insert:r=new ge(o,this.util);break;case m.Update:r=new z(o,this.util);break;case m.Remove:r=new $(o,this.util);break;case m.Count:r=new H(o,this.util)}r.isTxQuery=!0,r.execute(this.beforeExecute).then(i).catch(function(u){i({error:u})})},t.prototype.pushReq_=function(e){var r=this,i=function(){r.reqQueue.push(e)},o=d(function(u,s){e.onSuccess=function(a){u(a)},e.onError=function(a){s(a)}});return!0===this.isTxStarted_?(i(),this.processExecutionOfQry_()):i(),this.log("request pushed : "+e.name),o},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var r=this,i=null;return e.every(function(o){return null!=r.table(o)||(i=o,!1)}),i},t}(J),he=function(n){var t={name:n.name,version:n.version,tables:[]};return n.tables.forEach(function(e){var r={name:e.name,columns:{}};e.columns.forEach(function(i){r.columns[i.name]=i}),t.tables.push(r)}),t},De=function(){function n(t){this.middlewares=[],this.util=new ye,this.onQryFinished=me?function(e){self.postMessage(e)}:t}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),n.prototype.executeMiddleware_=function(t){var e=this,r=M(this.middlewares)-1;if(r<0)return _();var i={},o=this.db;return Object.defineProperty(i,"database",{get:function(){return he(o)}}),d(function(u){var s=0,a=function(){if(s<=r){var c=te(e.middlewares[s++])(t,i);(!c||!c.then)&&(c=Promise.resolve(c)),c.then(function(){a()})}else u()};a()})},n.prototype.executeQuery=function(t,e){var r,i=t.query;switch(t.name){case m.OpenDb:e(),r=this.openDb(i);break;case m.InitDb:e(),r=this.initDb(i);break;case m.CloseDb:e(),r=this.closeDb();break;case m.Insert:r=new ge(i,this.util).execute(e);break;case m.Select:r=new I(i,this.util).execute(e);break;case m.Count:r=new H(i,this.util).execute(e);break;case m.Update:r=new z(i,this.util).execute(e);break;case m.Intersect:e(),r=new wt(i,this.util).execute();break;case m.DropDb:e(),r=this.dropDb();break;case m.Terminate:e(),r=this.terminate();break;case m.Union:e(),r=new Ct(i,this.util).execute();break;case m.Remove:r=new $(i,this.util).execute(e);break;case m.Clear:r=new qt(i,this.util).execute(e);break;case m.Transaction:r=new At(i,this.util).execute(e);break;case m.Get:e(),r=E.get(i,this.util);break;case m.Set:e(),r=E.set(i.key,i.value,this.util);break;case m.ImportScripts:e(),r=this.importScripts_(t);break;case m.ChangeLogStatus:e(),this.logger.status=i,r=Promise.resolve();break;case m.Middleware:return e(),te(i)?(this.middlewares.push(i),_()):L(new w(h.InvalidMiddleware,i));default:console.error("The Api:-"+t.name+" does not support."),r=_()}return this.logger.log("Executing query "+t.name+" in web worker"),r},n.prototype.callResultMiddleware=function(t,e){return d(function(r){var i=0,o=M(t)-1,u=function(){if(i<=o){var s=t[i++](e);s instanceof Promise||(s=_(s)),s.then(function(a){e=a,u()})}else r(e)};u()})},n.prototype.callBeforeMiddleware=function(t){return d(function(e){var r=0,i=M(t)-1,o=function(){if(r<=i){var u=t[r++]();u instanceof Promise||(u=_(u)),u.then(o)}else e()};o()})},n.prototype.run=function(t){var e=this,r=[],i=[];t.onResult=function(o){r.push(function(u){return o(u)})},t.beforeExecute=function(o){i.push(function(u){return o(u)})},this.executeMiddleware_(t).then(function(){return e.executeQuery(t,function(){return e.callBeforeMiddleware(i)}).then(function(o){return e.callResultMiddleware(r,o).then(function(u){e.returnResult_({result:u})})})}).catch(function(o){r=[];var u=re(o);e.returnResult_({error:u})})},n.prototype.importScripts_=function(t){return d(function(e,r){try{importScripts.apply(void 0,t.query),e()}catch(o){r(new w(h.ImportScriptsFailed,o.message))}})},n.prototype.returnResult_=function(t){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(t)},n.prototype.dropDb=function(){var t=this.db.name;return this.terminate().then(function(){return(new kt).execute(t)})},n.prototype.closeDb=function(){return this.util.close()},n.prototype.terminate=function(){var t=this;return this.closeDb().then(function(){t.util.db=null})},n.prototype.openDb=function(t){var e=this;return this.closeDb().then(function(){return(e.db&&t.name===e.db.name?e.initDb():e.initDb({name:t.name,tables:[],version:t.version})).then(function(){return e.db})})},n.prototype.initDb=function(t){var e=this;if(!Ve)return L(new w(h.IndexedDbNotSupported));var r=t?new Oe(t):this.db;return this.util=new ye,d(function(i,o){e.util.initDb(r).then(function(u){u.isCreated?E.get(E.dbSchema,e.util).then(function(s){s&&s.tables.forEach(function(a,c){var l=r.tables[c];l&&(l.autoIncColumnValue=a.autoIncColumnValue)}),e.util.db=r,u.database=he(e.db),E.set(E.dbSchema,r,e.util).then(function(){i(u)})}):E.get(E.dbSchema,e.util).then(function(s){e.util.db=s,u.database=he(e.db),i(u)})}).catch(o)})},n}();if(me){var Lt=new De;self.onmessage=function(n){Lt.run(n.data)}}}});